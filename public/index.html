<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="styles/styles.css" />
    <title>Mis gastos</title>
  </head>
  <body>
    <h1 class="title">Estamos en la pagina principal</h1>
    <div>
      <input id="c1" />
      <input id="c2" />
      <button onclick="sumar()">Sumar</button>
      <p id="respuesta"></p>
    </div>
    
    <div>
      <input id="name" type="text" placeholder="nombre" />
      <input id="nickname" type="text" placeholder="nickname" />
      <input id="email" type="email" placeholder="correo" />
      <input id="password" type="password" placeholder="contaseña" />
      <input id="photo" type="text" placeholder="fotografia" />

      <button onclick="registrar()">Registrar usuario</button>
      <p id="resRegistro"></p>
    </div>

    <div>
      <h2> Iniciar Sesión </h2>
      <input id="emailLogin" type="email" placeholder="e-mail" />
      <input id="passwordLogin" type="password" placeholder="contaseña" />
      <button onclick="iniciarSesion()">Iniciar Sesión</button>
      <p id="respuestaLogin"></p>
    </div>

    <script type="application/javascript">
      function sumar() {
        console.log('Función Sumar')
        const c1 = document.getElementById('c1')
        const c2 = document.getElementById('c2')
        const respuesta = document.getElementById('respuesta')

        const number1 = Number(c1.value)
        const number2 = Number(c2.value)

        fetch('http://localhost:3000/suma', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            cantidad1: number1,
            cantidad2: number2,
          }),
        })
          .then((res) => res.json())
          .then((data) => {
            respuesta.innerHTML = data
          })
      }

      function registrar() {
        console.log('Función de Registro')
        const email = document.getElementById('email').value
        const password = document.getElementById('password').value
        const name = document.getElementById('name').value
        const nickname = document.getElementById('nickname').value
        const photo = document.getElementById('photo').value
        const resRegistro = document.getElementById('resRegistro')

        console.log({ email })
        console.log({ password })
        console.log({ name })

        fetch('http://localhost:3000/registro', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            email: email,
            password: password,
            name: name,
            nickname: nickname,
            photo_url: photo,
            user_role: 'user',
            user_status: true,
            resRegistro: resRegistro,
          }),
        }).then((res) => {
          console.log(res.status)
          console.log(res)
          if (res.status == 400) {
            resRegistro.innerHTML = 'Hubo un error'
          } else {
            return res.json().then((data) => {
              console.log(data)
              resRegistro.innerHTML = data.respuesta
            })
          }
        })
    }

    function iniciarSesion(){
      // traemos los valores email y password del HTML para iniciar sesión
      const email = document.getElementById('emailLogin').value 
      const password = document.getElementById('passwordLogin').value

      fetch('http://localhost:3000/login',{ //llamar al endpoint app.post('/login')
      //fetch necesita method, headers, body y la promesa o promesas
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({ // convertir a JSON
          email: email,
          password: password
        })
      }).then((res) => { //promesa para traer el res.status
        if (res.status === 400){ // si el codigo de error es 400. Viene de los settings del endpoint en index.js
          res.json().then((data) => {
            respuestaLogin.innerHTML = data.error; // muestra en HTML el elemento error del objeto respuesta. Puede ser error en email o error en pwd
          })
        } else {
          res.json().then((data) => { // si el codigo de error es diferente a 400. En este caso 200
            respuestaLogin.innerHTML = `Hola ${data.name} !! 🙉` // Data aquí es un objeto que contiene los datos del user en la DB. Sólo usamos el nombre para saludar
          })
        }
      })
    }
  </script>

</body>
</html>
